<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="author" content="Bruno G. Tavares">
  <meta name="description" content="Bruno's personal projects' page">
  <meta name="keywords" content="web development, data science, ruby, python, javaScript, reactjs, r, data analysis, statistics">

  <title>Bruno G. Tavares</title>

  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css">
  <link href='https://fonts.googleapis.com/css?family=News+Cycle' rel='stylesheet' type='text/css'>
  <link href="https://fonts.googleapis.com/css?family=Playfair+Display:400,400i,900,900i|Muli:400,400i" rel="stylesheet" type='text/css'>
  <link type="text/css" rel="stylesheet" href="/assets/main.css">

</head>

	<body>

		<!-- NAVIGATION -->
<nav class="navbar navbar-inverse" role="navigation">
    <div class="container">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
        </div>
        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse navbar-right" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav">
                <li>
                   <a href="/">Home</a>
                </li>
                <li>
                    <a href="/projects.html">Projects</a>
                </li>
                <li>
                  <a href="/blog.html">blog</a>
                </li>
                <li>
                  <a href="https://bgtavares.herokuapp.com/contacts">Contact</a>
                </li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>
<!-- END OF NAVIGATION -->


    <!-- Each Post -->
<div class="container">
  <div class="row post-width">
   <!-- Project Sidebar Widgets Column -->
<div class="col-md-4 col-sm-12 col-xs-12">

    <!-- Side Widget Well -->
    <div class="sidebar-style">
      <div class="row">
        <div class="col-md-12 col-sm-2 col-xs-12">
          <img src="/img/IMG_7794.JPEG" class="thumb-blog img-circle img-responsive" />
        </div>
        <div class="col-md-12 col-sm-5 col-xs-12 info-content">
          <h4>Bruno G. Tavares</h4>
          <p>Programmer - Musician - Artist</p>
          <p><i class="fa fa-map-marker" aria-hidden="true"></i> Brooklyn, NY</p>
        </div>
        <div class="col-md-12 col-sm-5 col-xs-12 social">
            <p>Find me here</p>
            <!-- Facebook -->
            <a onclick="javascript:window.open('https://github.com/bruno78', '_blank', 'width=800, height=500, top=200, left=300');void(0);"><i class="fa fa-github"></i></a>
            <!-- LinkedIn -->
            <a onclick="javascript:window.open('https://www.linkedin.com/in/bgtavares', '_blank', 'width=800, height=500, top=200, left=300');void(0);"><i class="fa fa-linkedin"></i></a>
        </div>
      </div>
    </div>

</div>

    <!-- Blog Post -->
   <div class="col-md-8 col-sm-12 col-xs-12 posts-font" id="left-border">

     <p class="date"><span>August 11, 2016</span></p>
     <!-- <span class="glyphicon glyphicon-time"></span> post.created_at.strftime("%B %d, %Y") -->
     <h2 id="post-title">
       Jobs board with multi-user
     </h2>
     <p class="lead">
       <span>by Bruno G. Tavares</span>
     </p>
      <!-- Author/tags -->
      <p class="lead-tag" align='center'>
        multi-user, Rails, Ruby, Jobsboard, and tutorial
      </p>

     <br>

      <!-- Preview Image -->
      
      <!-- Post Content -->
      <p id="blurb"><In this tutorial, I'll be showing how to create a multi-user capability where users upon sign-in will choose if they are signing in as a job-hunter or a company.></p>

      <p>Most job tutorials out there only teaches the very basics like how to set up a model, post jobs, apply for jobs, user sign up, sign in and sign out, leaving out the crucial fun: how to create user with different roles. I’ve looked into the Devise - Cancan - Rolify tutorial and for some reason it wasn’t very clear because most of these tutorials are focused on Administrator, Moderator and User/author sort of roles or roles assign by administrator or assigned in the console or a many-to-many relationship. I’m still learning Rails by myself and sometimes even posting questions on Stack Overflow is not very helpful. So some methods suggested to create a table with Roles… but when you deploy the app, would these roles would have to be assigned again since the database would be cleared. The closest approach was The RailsCasts on <a href="http://railscasts.com/episodes/189-embedded-association">Embedded Associations</a> but the video was from 2009 and I was using devise gem which works a bit different than following the formula. So everything was fine but upon sign up where I have a form to assign the role to the user but unfortunately when I look at the user role it was either nil or the default value… Frustrating…</p>

<p>Anyways, in this tutorial I’ll explain how to assign different roles upon sign-up where users will choose between “job-hunters” which will be able to apply for jobs and have profiles, and companies which will be able to post jobs and contact users. If you haven’t created the jobs-board app you can get my repo here (…) or watch Mackenzie Child Tutorial here (…).</p>

<p>Once you have the devise gem installed and you are all set, ready to sign up your first user, let’s add another gem, Enumerize. Open your Gemfile file and add this:</p>

<p>Gemfile</p>
<div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="n">gem</span> <span class="s1">'enumerize'</span>
</code></pre>
</div>
<p>on bash type:</p>
<div class="language-bash highlighter-rouge"><pre class="highlight"><code>bundle install
</code></pre>
</div>
<p>Then add a role column to your User model:</p>
<div class="language-bash highlighter-rouge"><pre class="highlight"><code>rails g migration add_role_to_users role:string
</code></pre>
</div>
<p>Update the database:</p>
<div class="language-bash highlighter-rouge"><pre class="highlight"><code>rake db:migrate
</code></pre>
</div>
<p>At app/model/user.rb, add the enumerize and roles:</p>
<div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="c1"># Include default devise modules. Others available are:</span>
  <span class="c1"># :confirmable, :lockable, :timeoutable and :omniauthable</span>
  <span class="n">devise</span> <span class="ss">:database_authenticatable</span><span class="p">,</span> <span class="ss">:registerable</span><span class="p">,</span>
         <span class="ss">:recoverable</span><span class="p">,</span> <span class="ss">:rememberable</span><span class="p">,</span> <span class="ss">:trackable</span><span class="p">,</span> <span class="ss">:validatable</span>
  <span class="kp">extend</span> <span class="no">Enumerize</span>
  <span class="n">enumerize</span> <span class="ss">:role</span><span class="p">,</span> <span class="ss">in: </span><span class="p">[</span><span class="ss">:job</span><span class="o">-</span><span class="n">hunter</span><span class="p">,</span> <span class="ss">:company</span><span class="p">],</span> <span class="ss">default: :job</span><span class="o">-</span><span class="n">hunter</span>
<span class="k">end</span>
</code></pre>
</div>
<p>Up to this point all the newly created users will have the job-hunter role as default. We will create the option to change at the sign up form where, if you are using devise, you can add this line &lt;%= f.select :role, User.role.options %&gt; at
views/devise/registrations/new.html.erb</p>
<div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="o">&lt;</span><span class="n">h2</span><span class="o">&gt;</span><span class="no">Sign</span> <span class="n">up</span><span class="o">&lt;</span><span class="sr">/h2&gt;

&lt;%= simple_form_for(resource, as: resource_name, url: registration_path(resource_name)) do |f| %&gt;
  &lt;%= f.error_notification %&gt;

  &lt;div class="form-inputs"&gt;
    &lt;%= f.input :email, required: true, autofocus: true %&gt;
    &lt;%= f.input :password, required: true, hint: ("</span><span class="si">#{</span><span class="vi">@minimum_password_length</span><span class="si">}</span><span class="sr"> characters minimum" if @minimum_password_length) %&gt;
    &lt;%= f.input :password_confirmation, required: true %&gt;
    &lt;%= f.select :role, User.role.options %&gt;
  &lt;/</span><span class="n">div</span><span class="o">&gt;</span>

  <span class="o">&lt;</span><span class="n">div</span> <span class="k">class</span><span class="o">=</span><span class="s2">"form-actions"</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="sx">%= f.button :submit, "Sign up" %&gt;
  &lt;/div&gt;
&lt;% end %&gt;

&lt;%=</span> <span class="n">render</span> <span class="s2">"devise/shared/links"</span> <span class="o">%&gt;</span>
</code></pre>
</div>
<p>Now the missing key for me is here, the only way the changes would be permanent if you add the new key to permissions. I knew that but since we didn’t have UserController file because devise takes care of that for us, I didn’t know where to do it. It’s on the devise documentation but for a beginner like me it wasn’t obvious…</p>

<p>app/controllers/application_controller.rb</p>
<div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="k">class</span> <span class="nc">ApplicationController</span> <span class="o">&lt;</span> <span class="no">ActionController</span><span class="o">::</span><span class="no">Base</span>
  <span class="c1"># Prevent CSRF attacks by raising an exception.</span>
  <span class="c1"># For APIs, you may want to use :null_session instead.</span>
  <span class="n">protect_from_forgery</span> <span class="ss">with: :exception</span>

  <span class="n">before_action</span> <span class="ss">:configure_devise_permitted_parameters</span><span class="p">,</span> <span class="ss">if: :devise_controller?</span>

  <span class="kp">protected</span>

  <span class="k">def</span> <span class="nf">configure_devise_permitted_parameters</span>
    <span class="n">devise_parameter_sanitizer</span><span class="p">.</span><span class="nf">permit</span><span class="p">(</span><span class="ss">:sign_up</span><span class="p">,</span> <span class="ss">keys: </span><span class="p">[</span><span class="ss">:role</span><span class="p">])</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
</div>
<p>Once you create the method and add the key :role sign up, the changes will be permanent. Next step, set restrictions/privilege for the each roles</p>
<br>

     <hr>

      <!-- Share Project -->
      <!-- Share Project -->
<div class="container share-me">
  <div class="row">
    <div class="col-sm-12">
      <p>Share this project</p>

      <!-- Twitter -->
      <a onclick="javascript:window.open('https://twitter.com/intent/tweet?text= by Bruno G. Tavares - &url=http://127.0.0.1:4000/', '_blank', 'width=800, height=500, top=200, left=300');void(0);"><i class="fa fa-twitter"></i></a>

      <!-- Facebook -->
      <a onclick="javascript:window.open('https://facebook.com/sharer.php?u=http://127.0.0.1:4000/', '_blank', 'width=800, height=500, top=200, left=300');void(0);"><i class="fa fa-facebook"></i></a>

      <!-- Google Plus -->
      <a onclick="javascript:window.open('https://plus.google.com/share?url=http://127.0.0.1:4000/', '_blank', 'width=800, height=500, top=200, left=300');void(0);"><i class="fa fa-google-plus"></i></a>

      <!-- LinkedIn -->
      <a onclick="javascript:window.open('http://www.linkedin.com/shareArticle?mini=true&url=http://127.0.0.1:4000/&title=&source=http://127.0.0.1:4000/', '_blank', 'width=800, height=500, top=200, left=300');void(0);"><i class="fa fa-linkedin"></i></a>

    </div>
  </div>
</div>

      </div>
   </div>

  </div>
</div>


    <footer>
  <div class="containe find-me">
    <div class="row">
      <div class="col-md-12">
        <p> &copy 2016 by Bruno G. Tavares. All rights reserved. </p>
      </div>
    </div>
  </div>
</footer>

		<script   src="https://code.jquery.com/jquery-3.1.0.min.js"   integrity="sha256-cCueBR6CsyA4/9szpPfrX3s49M9vUU5BgtiJj06wt/s="   crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

  </body>
</html>
